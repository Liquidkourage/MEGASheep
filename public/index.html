<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEGASheep Trivia</title>
    <link rel="stylesheet" href="styles.css?v=2025-08-14T02-49-59">
    <script src="/socket.io/socket.io.js"></script>
    <script>
      // Unregister any old service worker so '/' never shows stale content
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
          regs.forEach(r => {
            if (r && r.active) {
              try { r.unregister(); } catch(_) {}
            }
          });
        }).catch(()=>{});
      }
    </script>
</head>
<body>
    <div class="container">
        <!-- Welcome Screen removed: root should only show Join Game for players -->

        <!-- Create Game Screen removed: hosting happens on /host -->

        <!-- Join Game Screen (default active) -->
        <div id="joinGameScreen" class="screen active">
            <div class="screen-content">
                <h2>Join Game</h2>
                <div class="form-group">
                    <label for="gameCode">Game Code:</label>
                    <input type="text" id="gameCode" placeholder="Enter 4-digit game code" maxlength="4" pattern="[0-9]{4}" required autocomplete="off">
                </div>
                <div class="form-group">
                    <label for="playerName">Your Name:</label>
                    <input type="text" id="playerName" placeholder="Enter your name" required>
                </div>
                <button id="joinGameSubmitBtn" class="btn btn-primary">Join Game</button>
            </div>
        </div>

        <!-- Lobby Screen -->
        <div id="lobbyScreen" class="screen">
            <div class="screen-content">
                <div class="lobby-header">
                    <h2>Game Lobby</h2>
                    <p class="lobby-subtitle">Waiting for players to join...</p>
                </div>
                
                <!-- Host Game Management Panel intentionally hidden on player page -->
                <div id="hostGamePanel" class="host-game-panel" style="display: none;"></div>
                
                <div class="players-header">
                    <h3>üë• Players (<span id="playerCount">0</span>)</h3>
                    <div class="players-actions" id="playersActions" style="display: none;">
                        <button id="kickPlayerBtn" class="btn btn-danger btn-small">
                            <span class="btn-icon">üö´</span>
                            Kick Player
                        </button>
                    </div>
                </div>
                <div class="players-list">
                    <div id="playersList" class="players-grid"></div>
                    
                    <!-- Player Details Modal -->
                    <div id="playerModal" class="modal" style="display: none;">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h4>Player Details</h4>
                                <span class="close">&times;</span>
                            </div>
                            <div class="modal-body">
                                <div class="player-info">
                                    <div class="player-avatar">üë§</div>
                                    <div class="player-details">
                                        <h5 id="modalPlayerName">Player Name</h5>
                                        <p id="modalPlayerScore">Score: 0</p>
                                        <p id="modalPlayerStatus">Status: Active</p>
                                    </div>
                                </div>
                                <div class="player-actions">
                                    <button id="kickPlayerModalBtn" class="btn btn-danger">Kick Player</button>
                                    <button id="mutePlayerBtn" class="btn btn-warning">Mute Player</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="scoring-explanation" style="margin: 20px 0; padding: 15px; background: rgba(0, 123, 255, 0.1); border: 1px solid rgba(0, 123, 255, 0.3); border-radius: 10px; text-align: center;">
                    <p style="margin: 0 0 8px 0;"><strong>Scoring System:</strong> Points = Total Responses √∑ Responses with same answer (rounded up)</p>
                    <p style="margin: 0; font-style: italic;">Rarer answers earn more points!</p>
                </div>

                <div class="lobby-actions">
                    <button id="leaveGameBtn" class="btn btn-secondary">Leave Game</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <div class="game-header">
                <div class="game-info">
                    <span class="question-counter">Round <span id="roundNumber">1</span> ‚Ä¢ Question <span id="questionNumber">1</span> of <span id="totalQuestions">5</span></span>
                </div>
                <div class="timer" id="timer">30</div>
            </div>

            <div class="question-container">
                <h2 id="questionText" class="question-text"></h2>
                
                <!-- Player Answer Form (hidden for host) -->
                <div id="playerAnswerForm" class="answer-form" style="display: none; gap: 8px !important; align-items: center; margin-top: 30px;">
                    <input type="text" id="answerInput" placeholder="Type your answer..." maxlength="100">
                    <button id="submitAnswerBtn" class="btn btn-primary">Submit Answer</button>
                </div>
                <!-- Multi-purpose communication: answerStatus doubles as input/display -->
                <div id="playerCommRow" style="display:none;margin-top: 25px; gap:8px; align-items:center; display:flex;">
                    <div id="answerStatus" class="answer-status" role="textbox" aria-multiline="true" contenteditable="true" data-placeholder="Type a private message to host..." style="flex:1; min-height:38px; padding:10px 12px;"></div>
                    <button id="askHostBtn" class="btn btn-secondary" type="button" style="white-space:nowrap;">Send to host</button>
                </div>
                <div id="dmHistory" style="margin-top:6px; font-size:13px; color: #cfd8dc;"></div>
                
                <!-- Host Controls (hidden for players) -->
                <div id="hostControls" class="host-controls" style="display: none;">
                    <div class="host-info">
                        <p>Players are answering...</p>
                        <div class="answer-status">
                            <span id="answersReceived">0</span> / <span id="totalPlayers">0</span> answers received
                        </div>
                    </div>
                    <div class="host-actions">
                        <button id="endQuestionBtn" class="btn btn-warning">End Question</button>
                        <a class="btn btn-primary" href="/host">Open Host Console</a>
                    </div>
                </div>
            </div>

            <div class="players-status">
                <div id="gamePlayersList" class="players-grid"></div>
            </div>
        </div>

        <!-- Scoring Screen -->
        <div id="scoringScreen" class="screen">
            <div class="screen-content">
                <h2 id="scoringTitle">Question Results</h2>
                <button id="scoresFab" class="scores-fab" type="button" title="View Current Scores">View Current Scores</button>

                
                <!-- Host Answer Categorization Interface -->
                <div id="hostAnswerCategorization" class="answer-categorization" style="display: none;">
                    <h3>üéØ Categorize Answers (Host Only)</h3>
                    <p class="categorization-instructions">Drag answers to group similar responses together. Click to mark as correct/incorrect.</p>
                    
                    <div class="categorization-container">
                        <!-- Correct Answer Buckets (dynamically created) -->
                        <div class="correct-answer-buckets-section">
                            <h4>‚úÖ Correct Answer Buckets</h4>
                            <div id="correctAnswerBuckets" class="correct-answer-buckets">
                                <!-- Correct answer buckets will be created here -->
                            </div>
                        </div>
                        
                        <!-- Uncategorized Answers -->
                        <div class="answer-bucket uncategorized-bucket">
                            <h4>üìù Uncategorized Answers</h4>
                            <div id="uncategorizedAnswers" class="answer-items" data-bucket="uncategorized">
                                <!-- Uncategorized answers will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Wrong Answers Bucket -->
                        <div class="answer-bucket wrong-bucket">
                            <h4>‚ùå Wrong Answers</h4>
                            <div id="wrongAnswers" class="answer-items" data-bucket="wrong">
                                <!-- Wrong answers will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Custom Buckets Container -->
                        <div class="custom-buckets-container">
                            <h4>üì¶ Custom Groups</h4>
                            <div class="bucket-controls">
                                <button id="addBucketBtn" class="btn btn-small">‚ûï Add Group</button>
                                <button id="mergeBucketsBtn" class="btn btn-small">üîó Merge Selected</button>
                            </div>
                            <div id="customBuckets" class="custom-buckets">
                                <!-- Custom buckets will be created here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="categorization-actions">
                        <button id="previewScoringBtn" class="btn btn-primary">Preview Scoring</button>
                        <button id="applyCategorizationBtn" class="btn btn-success">Apply & Continue</button>
                        <button id="autoCategorizeBtn" class="btn btn-secondary">Auto-Categorize</button>
                    </div>
                </div>
                
                <!-- Standard Answers Display (for players and after categorization) -->
                <div id="standardAnswersDisplay" class="answers-display">
                    <h3>Answers & Points:</h3>
                    <div id="answersList" class="answers-grid"></div>
                </div>
                
                <div class="scoring-actions top-actions">
                    <button id="nextQuestionBtn" class="btn btn-primary" style="display: none;">Next Question</button>
                    <button id="endGameBtn" class="btn btn-secondary" style="display: none;">End Game</button>
                </div>
            </div>
        </div>

        <!-- Current Scores Modal -->
        <div id="scoresModal" class="modal" style="display: none;">
            <div class="modal-content scores-modal">
                <div class="modal-header">
                    <h4>üìä Current Scores</h4>
                    <span class="close" id="closeScoresModal">&times;</span>
                </div>
                <div class="modal-body">
                    <div id="scoresList" class="scores-grid"></div>
                </div>
            </div>
        </div>

        

        <!-- Grading Interface Modal -->
        <div id="gradingModal" class="modal" style="display: none;">
            <div class="modal-content grading-modal">
                <div class="modal-header">
                    <h4>üéØ Answer Grading Interface</h4>
                    <div class="modal-controls">
                        <button id="toggleFullscreenBtn" class="btn btn-small" title="Toggle Full Screen">
                            <span class="btn-icon">‚õ∂</span>
                        </button>
                        <span class="close" id="closeGradingModal">&times;</span>
                    </div>
                </div>
                <div class="modal-body">
                    <!-- Question Selection -->
                    <div class="question-selector">
                        <label for="gradingQuestionSelect">Select Question:</label>
                        <select id="gradingQuestionSelect" class="grading-input">
                            <option value="">Choose a question...</option>
                        </select>
                    </div>
                    
                    <!-- Question Display -->
                    <div id="gradingQuestionDisplay" class="grading-question-display" style="display: none;">
                        <h5 id="gradingQuestionText"></h5>
                        <p class="grading-question-info">
                            <span id="gradingQuestionNumber"></span> ‚Ä¢ 
                            <span id="gradingAnswerCount">0 answers</span>
                        </p>
                    </div>
                    
                    <!-- Answer Categorization Interface -->
                    <div id="gradingAnswerCategorization" class="answer-categorization" style="display: none;">
                        <p class="categorization-instructions">Drag answers to group similar responses together. Click to mark as correct/incorrect.</p>
                        
                        <div class="categorization-container">
                            <!-- Correct Answer Buckets (dynamically created) -->
                            <div class="correct-answer-buckets-section">
                                <h4>‚úÖ Correct Answer Buckets</h4>
                                <div id="gradingCorrectAnswerBuckets" class="correct-answer-buckets">
                                    <!-- Correct answer buckets will be created here -->
                                </div>
                            </div>
                            
                            <!-- Uncategorized Answers -->
                            <div class="answer-bucket uncategorized-bucket">
                                <h4>üìù Uncategorized Answers</h4>
                                <div id="gradingUncategorizedAnswers" class="answer-items" data-bucket="uncategorized">
                                    <!-- Uncategorized answers will be populated here -->
                                </div>
                            </div>
                            
                            <!-- Wrong Answers Bucket -->
                            <div class="answer-bucket wrong-bucket">
                                <h4>‚ùå Wrong Answers</h4>
                                <div id="gradingWrongAnswers" class="answer-items" data-bucket="wrong">
                                    <!-- Wrong answers will be populated here -->
                                </div>
                            </div>
                            
                            <!-- Custom Buckets Container -->
                            <div class="custom-buckets-container">
                                <h4>üì¶ Custom Groups</h4>
                                <div class="bucket-controls">
                                    <button id="gradingAddBucketBtn" class="btn btn-small">‚ûï Add Group</button>
                                    <button id="gradingMergeBucketsBtn" class="btn btn-small">üîó Merge Selected</button>
                                </div>
                                <div id="gradingCustomBuckets" class="custom-buckets">
                                    <!-- Custom buckets will be created here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="categorization-actions">
                            <button id="gradingPreviewScoringBtn" class="btn btn-primary">Preview Scoring</button>
                            <button id="gradingApplyCategorizationBtn" class="btn btn-success">Apply Changes</button>
                            <button id="gradingAutoCategorizeBtn" class="btn btn-secondary">Auto-Categorize</button>
                        </div>
                    </div>
                    
                    <!-- No Question Selected Message -->
                    <div id="gradingNoQuestionMessage" class="grading-no-question">
                        <p>Please select a question to begin grading.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overall Leaderboard Screen -->
        <div id="gameOverScreen" class="screen">
            <div class="screen-content">
                <h2 id="overallTitle">Overall Leaderboard</h2>
                <div class="final-scores">
                    <h3 id="overallSubtitle">After <span id="overallQuestionsCount">0</span> questions:</h3>
                    <div id="finalScoresList" class="scores-grid"></div>
                </div>
                
                <div class="winner-announcement" style="display:none;">
                    <h3 id="winnerText"></h3>
                </div>

                <!-- No actions for players on overall leaderboard -->
            </div>
        </div>


    </div>

    <script src="script.js?v=2025-08-14T02-49-59"></script>
  <!-- Removed sticky player footer -->
</body>
</html> 